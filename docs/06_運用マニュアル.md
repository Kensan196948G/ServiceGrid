# ServiceGrid 運用マニュアル

## 1. システム概要

ServiceGrid は ITIL準拠のIT運用システムプラットフォームです。インシデント管理、資産管理、変更管理などの包括的なITSM機能を提供し、組織のIT運用を効率化します。

### 1.1 主要機能
- **インシデント管理**: 障害・問題の記録・追跡・解決
- **資産管理**: IT資産の包括的な管理・追跡
- **変更管理**: 設定変更の計画・承認・実施
- **サービスリクエスト**: ユーザー申請・要求管理
- **ナレッジ管理**: 情報・手順書の蓄積・検索
- **問題管理**: 根本原因分析・再発防止
- **SLA管理**: サービスレベル監視・KPI追跡

## 2. システム起動・停止

### 2.1 推奨起動方法（ワンコマンド）

```bash
cd /mnt/e/ServiceGrid
npm run start:all
```

**正常起動時の表示例:**
```
🚀 ITSM システムを起動しています...
=======================================
🧹 既存のプロセスをクリーンアップ中...
🔧 バックエンドサーバーを起動中...
🎨 フロントエンドサーバーを起動中...
=======================================
✅ システム起動完了！

🌐 アクセスURL:
   フロントエンド: http://localhost:3001
   バックエンド:   http://localhost:8082

🔑 テストログイン:
   ユーザー名: admin
   パスワード: admin123

⏹️  停止方法:
   ./stop-all.sh を実行
   または Ctrl+C を2回押す
```

### 2.2 個別起動方法

#### バックエンドのみ起動
```bash
cd /mnt/e/ServiceGrid
npm run backend
```

#### フロントエンドのみ起動  
```bash
cd /mnt/e/ServiceGrid
npm run frontend
```

### 2.3 システム停止

#### 推奨停止方法
```bash
npm run stop:all
```

#### その他の停止方法
| 方法 | コマンド | 用途 |
|------|----------|------|
| スクリプト | `./stop-all.sh` | 推奨 |
| キーボード | `Ctrl+C` を2回 | 起動中ターミナル |
| 強制停止 | `pkill -f "vite\|start-server"` | 緊急時 |

## 3. アクセス方法

### 3.1 メインアクセスURL

| サービス | URL | 説明 |
|----------|-----|------|
| **フロントエンド** | http://localhost:3001 | メインのWebアプリケーション |
| **バックエンドAPI** | http://localhost:8082 | REST APIサーバー |

### 3.2 APIテストエンドポイント

| エンドポイント | 用途 | 期待レスポンス |
|----------------|------|----------------|
| http://localhost:8082 | メイン | JSON形式のAPI情報 |
| http://localhost:8082/ping | 疎通確認 | `pong` |
| http://localhost:8082/api/test | API動作確認 | 詳細システム情報 |
| http://localhost:8082/api/health | ヘルスチェック | システム状態 |

## 4. ログイン・認証

### 4.1 デフォルトアカウント

| ロール | ユーザー名 | パスワード | 権限 |
|--------|-----------|----------|------|
| **管理者** | `admin` | `admin123` | 全機能アクセス |
| **オペレータ** | `operator` | `operator123` | 運用機能のみ |

> ⚠️ **セキュリティ警告**: 本番環境では必ずパスワードを変更してください

### 4.2 ログイン手順

1. http://localhost:3001 にアクセス
2. ユーザー名とパスワードを入力
3. 「ログイン」ボタンをクリック
4. ダッシュボードに自動転送

### 4.3 ユーザーロール

| ロール | 権限レベル | 説明 |
|--------|-----------|------|
| administrator | 全権限 | 全機能のCRUD操作・システム設定 |
| operator | 制限付き書き込み | 削除権限なし・日常運用 |
| user | 読み書き | 基本操作権限・申請作成 |
| readonly | 読み取り専用 | 閲覧のみ |

## 5. 各機能の操作方法

### 5.1 ダッシュボード

**機能**: システム全体の状況を一元監視
- **KPI表示**: インシデント数・資産数・SLA達成率
- **グラフ表示**: 傾向分析・統計情報
- **クイックアクション**: 頻繁なタスクへのショートカット

**操作手順**:
1. ログイン後、自動的にダッシュボードが表示
2. 各KPIカードで詳細情報を確認
3. グラフをクリックして詳細ページに移動

### 5.2 インシデント管理

**機能**: 障害・問題の記録・追跡・解決管理

#### インシデント作成
1. 「インシデント管理」メニューをクリック
2. 「新規作成」ボタンをクリック
3. 必須項目を入力:
   - **タイトル**: 簡潔な問題概要
   - **説明**: 詳細な問題内容
   - **報告者**: 問題報告者名
   - **優先度**: Low/Medium/High/Critical
   - **カテゴリ**: Infrastructure/Software/Hardware等
4. 「保存」ボタンをクリック

#### インシデント更新
1. インシデント一覧から対象を選択
2. 「編集」ボタンをクリック
3. ステータス・担当者・解決内容等を更新
4. 「保存」ボタンをクリック

#### フィルタリング・検索
- **ステータスフィルタ**: Open/In Progress/Resolved/Closed
- **優先度フィルタ**: Critical/High/Medium/Low
- **テキスト検索**: タイトル・説明文での検索
- **担当者フィルタ**: 特定ユーザーのインシデント表示

### 5.3 資産管理

**機能**: IT資産の包括的な管理・追跡

#### 資産登録
1. 「資産管理」メニューをクリック
2. 「新規登録」ボタンをクリック
3. 基本情報を入力:
   - **資産タグ**: 一意識別子（例: SRV-001）
   - **資産名**: わかりやすい名称
   - **カテゴリ**: Server/Workstation/Network等
   - **製造元・モデル**: ハードウェア情報
   - **設置場所**: 物理的な場所
   - **担当者**: 使用者・責任者
4. 詳細情報を入力:
   - **購入日・購入費用**: 調達情報
   - **保証期限**: サポート期限
   - **IP・MACアドレス**: ネットワーク情報
   - **OS・ライセンス**: ソフトウェア情報
5. 「保存」ボタンをクリック

#### 資産検索・フィルタ
- **ステータス**: Active/Inactive/Maintenance/Retired
- **カテゴリ**: Server/Workstation/Network等
- **場所**: データセンター・オフィス等
- **担当者**: 特定ユーザーの資産
- **テキスト検索**: 名前・タグ・製造元等

### 5.4 サービスリクエスト管理

**機能**: ユーザー申請・要求管理

#### リクエスト作成
1. 「サービスリクエスト」メニューをクリック
2. 「新規申請」ボタンをクリック
3. 申請情報を入力:
   - **件名**: 申請概要
   - **詳細**: 具体的な要求内容
   - **申請者**: 要求者名
   - **優先度**: 業務への影響度
4. 「申請」ボタンをクリック

#### 承認・却下
1. 申請一覧から対象を選択
2. 内容を確認
3. 「承認」または「却下」をクリック
4. 必要に応じてコメントを追加

### 5.5 変更管理

**機能**: 設定変更の計画・承認・実施管理

#### 変更要求作成
1. 「変更管理」メニューをクリック  
2. 「変更要求」ボタンをクリック
3. 変更情報を入力:
   - **件名**: 変更概要
   - **詳細**: 変更内容・目的・影響範囲
   - **要求者**: 変更要求者
   - **実施予定日**: 変更実施スケジュール
4. 「要求」ボタンをクリック

#### 変更承認・実施
1. 要求一覧から対象を選択
2. 変更内容・リスク・影響を評価
3. 「承認」または「却下」をクリック
4. 承認後、実施・完了報告

### 5.6 ナレッジ管理

**機能**: 情報・手順書の蓄積・検索

#### 記事作成
1. 「ナレッジ管理」メニューをクリック
2. 「新規記事」ボタンをクリック
3. 記事情報を入力:
   - **タイトル**: 記事名
   - **カテゴリ**: 分類（技術・手順・FAQ等）
   - **本文**: 詳細内容（Markdown対応）
   - **タグ**: 検索用キーワード
4. 「公開」ボタンをクリック

#### 記事検索
- **キーワード検索**: タイトル・本文での全文検索
- **カテゴリフィルタ**: 技術・手順・FAQ等
- **タグフィルタ**: 関連タグでの絞り込み
- **作成者フィルタ**: 特定ユーザーの記事

## 6. 動作確認・テスト

### 6.1 起動確認チェックリスト

- [ ] バックエンドサーバーが起動している
- [ ] フロントエンドサーバーが起動している  
- [ ] http://localhost:3001 にアクセス可能
- [ ] http://localhost:8082 にアクセス可能
- [ ] ログイン機能が正常動作
- [ ] ダッシュボードが表示される

### 6.2 APIテスト手順

#### 疎通確認
```bash
curl http://localhost:8082/ping
# 期待される結果: pong
```

#### ヘルスチェック
```bash
curl http://localhost:8082/api/health
# 期待される結果: {"status":"✅ OK", ...}
```

#### ログインAPI確認
```bash
curl -X POST http://localhost:8082/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
# 期待される結果: {"success":true,"token":"...", ...}
```

### 6.3 ブラウザテスト

| テスト項目 | URL | 期待結果 |
|------------|-----|----------|
| **メインページ** | http://localhost:3001 | ログインページ表示 |
| **API確認** | http://localhost:8082 | JSON情報表示 |
| **疎通確認** | http://localhost:8082/ping | "pong"表示 |
| **ヘルスチェック** | http://localhost:8082/api/health | ステータス情報表示 |

## 7. トラブルシューティング

### 7.1 ポート使用中エラー

**症状**: `Port 8082 is already in use!`

**解決方法**:
```bash
# 方法1: 停止スクリプト実行
npm run stop:all

# 方法2: プロセス強制終了
pkill -f "start-server\|vite"

# 方法3: ポート確認・終了
lsof -ti:8082 | xargs kill -9
```

### 7.2 ブラウザアクセス不可

**症状**: "このページに到達できません"

**確認項目**:
1. サーバーが起動しているか確認
2. ポート番号が正しいか確認  
3. WSLとWindowsの通信確認

**解決方法**:
```bash
# サーバー状態確認
ps aux | grep "node\|vite"

# ポート確認
lsof -i :3001 -i :8082

# 再起動
npm run stop:all && npm run start:all
```

### 7.3 ログインできない

**症状**: "Invalid credentials"

**確認項目**:
1. ユーザー名: `admin` または `operator`
2. パスワード: `admin123` または `operator123`
3. バックエンドAPIが正常動作しているか

**解決方法**:
```bash
# バックエンド動作確認
curl http://localhost:8082/api/health

# ログインAPI確認
curl -X POST http://localhost:8082/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### 7.4 依存関係エラー

**症状**: `Module not found` または `npm install`失敗

**解決方法**:
```bash
# フロントエンド依存関係再インストール
cd /mnt/e/ServiceGrid
rm -rf node_modules package-lock.json
npm install

# バックエンド依存関係再インストール  
cd backend
rm -rf node_modules package-lock.json
npm install
```

### 7.5 完全リセット手順

```bash
# 1. 全プロセス停止
npm run stop:all
pkill -f "node\|vite"

# 2. ポートクリア
lsof -ti:3001,8082 | xargs kill -9

# 3. 依存関係再インストール
rm -rf node_modules package-lock.json
rm -rf backend/node_modules backend/package-lock.json
npm install
cd backend && npm install && cd ..

# 4. システム再起動
npm run start:all
```

## 8. 監視・メンテナンス

### 8.1 重要監視指標

#### システムリソース
| 項目 | 正常範囲 | 警告しきい値 | 確認方法 |
|------|----------|--------------|----------|
| **CPU使用率** | < 50% | > 80% | `top` または `htop` |
| **メモリ使用量** | < 70% | > 90% | `free -h` |
| **ディスク容量** | < 80% | > 95% | `df -h` |

#### アプリケーション
| 項目 | 確認方法 | 正常状態 |
|------|----------|----------|
| **フロントエンド応答** | http://localhost:3001 | 2秒以内にロード |
| **バックエンド応答** | http://localhost:8082/ping | "pong"レスポンス |
| **認証機能** | ログインテスト | 正常ログイン可能 |

### 8.2 ログ監視

#### ログファイル場所
```bash
# フロントエンドログ（ブラウザ開発者ツール）
# バックエンドログ（コンソール出力）

# プロセス確認
ps aux | grep "node\|vite"

# ポート使用状況
lsof -i :3001 -i :8082
```

### 8.3 定期作業

#### 始業時チェック
- [ ] システム起動: `npm run start:all`
- [ ] 動作確認: 各URLアクセステスト  
- [ ] ログインテスト: 管理者・オペレータアカウント
- [ ] リソース確認: CPU・メモリ使用量

#### 終業時作業  
- [ ] データバックアップ（必要に応じて）
- [ ] システム停止: `npm run stop:all`
- [ ] 運用ログ記録

#### 週次点検
- [ ] システム再起動テスト
- [ ] リソース使用量確認
- [ ] データベース状態確認
- [ ] セキュリティ更新確認

### 8.4 メンテナンス作業

#### システム更新
```bash
# 1. システム停止
npm run stop:all

# 2. コード更新（git pullなど）
git pull origin main

# 3. 依存関係更新
npm install
cd backend && npm install && cd ..

# 4. システム再起動
npm run start:all
```

#### データベースメンテナンス
```bash
# データベースバックアップ
cp backend/db/itsm.sqlite backend/db/itsm_backup_$(date +%Y%m%d).sqlite

# データベース最適化
sqlite3 backend/db/itsm.sqlite "VACUUM;"
```

## 9. セキュリティ運用

### 9.1 セキュリティ設定

#### パスワードポリシー
- **最小長**: 8文字以上
- **複雑性**: 英数字・記号を含む
- **有効期限**: 90日（推奨）
- **履歴**: 過去5個のパスワード使用不可

#### セッション管理
- **セッション有効期限**: 30分（無操作時）
- **強制ログアウト**: 8時間後
- **同時セッション**: 1ユーザー1セッションのみ

### 9.2 監査・ログ管理

#### 監査対象
- **ログイン・ログアウト**: 全ユーザー
- **権限変更**: 管理者操作
- **データ変更**: CRUD操作
- **システム設定変更**: 設定変更

#### ログ保存期間
- **アクセスログ**: 1年間
- **操作ログ**: 3年間  
- **エラーログ**: 6ヶ月間
- **セキュリティログ**: 5年間

## 10. バックアップ・リストア

### 10.1 バックアップ戦略

#### 自動バックアップ
```bash
# 日次バックアップスクリプト例
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup/servicegrid"
DB_FILE="backend/db/itsm.sqlite"

# データベースバックアップ
cp $DB_FILE $BACKUP_DIR/itsm_$DATE.sqlite

# 設定ファイルバックアップ  
tar -czf $BACKUP_DIR/config_$DATE.tar.gz backend/.env

# 古いバックアップ削除（30日以上）
find $BACKUP_DIR -name "*.sqlite" -mtime +30 -delete
```

#### バックアップ確認
```bash
# バックアップファイル確認
ls -la /backup/servicegrid/

# データベース整合性確認
sqlite3 /backup/servicegrid/itsm_YYYYMMDD.sqlite "PRAGMA integrity_check;"
```

### 10.2 リストア手順

#### データベースリストア
```bash
# 1. システム停止
npm run stop:all

# 2. 現在のデータベースバックアップ
cp backend/db/itsm.sqlite backend/db/itsm_before_restore.sqlite

# 3. バックアップからリストア
cp /backup/servicegrid/itsm_YYYYMMDD.sqlite backend/db/itsm.sqlite

# 4. システム再起動
npm run start:all

# 5. 動作確認
curl http://localhost:8082/api/health
```

## 11. サポート・連絡先

### 11.1 緊急時連絡先

| 種別 | 連絡先 | 対応時間 |
|------|--------|----------|
| **システム障害** | IT部門 | 24時間 |
| **セキュリティ** | セキュリティ部門 | 24時間 |  
| **業務サポート** | ヘルプデスク | 平日 9:00-18:00 |

### 11.2 問題報告

問題が発生した場合は、以下の情報を含めて報告してください：

```
発生時刻: YYYY/MM/DD HH:MM
問題内容: [具体的な症状]
アクセスURL: [問題が発生したURL]
ユーザー: [使用していたアカウント]
実行コマンド: [実行していたコマンド]
エラーメッセージ: [表示されたエラー]
```

### 11.3 参考資料

- **開発ガイド**: DEVELOPMENT.md - 開発者向け詳細情報
- **API仕様書**: docs/03_API仕様書.md - REST API仕様
- **データベース仕様**: docs/04_データベース仕様書.md - DB構造
- **フロントエンド仕様**: docs/05_フロントエンド仕様書.md - UI仕様

### 11.4 改善提案

システム改善のご提案やフィードバックをお待ちしています：
- **Email**: it-support@company.com
- **Issue**: GitHubリポジトリのIssue機能
- **Teams**: ITSMプロジェクトチャンネル

---

**📅 最終更新: 2025年12月6日**

このマニュアルにより、ServiceGrid ITSMシステムの安全で効率的な運用が可能となります。定期的な見直しと更新により、最新の運用状況に対応してください。