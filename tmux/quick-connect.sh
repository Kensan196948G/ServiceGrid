#!/bin/bash

# tmuxæ¥ç¶šæ™‚ã«Claude Codeã‚‚è‡ªå‹•èµ·å‹•ã™ã‚‹çµ±åˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

SESSION_NAME="itsm-requirement"

echo "ğŸš€ ITSMé–‹ç™ºç’°å¢ƒ - Claude Codeçµ±åˆèµ·å‹•ä¸­..."

# ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
if ! tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
    echo "ğŸ“‹ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€æ–°è¦ä½œæˆã—ã¾ã™..."
    ./start-development.sh
    exit 0
fi

echo "ğŸ”§ Claude Codeç’°å¢ƒè¨­å®šå®Ÿè¡Œä¸­ (éå¯¾è©±å‹)..."
./setup-claude-noninteractive.sh both

echo "ğŸ¯ Feature-A-Leaderçµ±åˆãƒªãƒ¼ãƒ€ãƒ¼æ©Ÿèƒ½è¨­å®šä¸­..."
./setup-leader-pane.sh setup

echo "ğŸ”— tmux hookè¨­å®šä¸­ (ä»Šå¾Œã®attachæ™‚è‡ªå‹•èµ·å‹•)..."
./auto-claude-hook.sh setup

echo ""
echo "âœ… æº–å‚™å®Œäº†ï¼tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ¥ç¶šã—ã¾ã™..."
echo ""
echo "ğŸ¯ tmux 3æ®µæ§‹æˆçµ±åˆé–‹ç™ºç’°å¢ƒ"
echo "  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "  â”‚ 1æ®µç›®ï¼ˆä¸Šæ®µï¼‰                       â”‚"
echo "  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
echo "  â”‚ â”‚ 0:Feature-B-UI â”‚ 1:Feature-C-API     â”‚"
echo "  â”‚ â”‚ UI/ãƒ†ã‚¹ãƒˆ      â”‚ APIé–‹ç™º              â”‚"
echo "  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
echo "  â”‚ â”‚ 2æ®µç›®ï¼ˆä¸­æ®µï¼‰                     â”‚"
echo "  â”‚ â”‚ 2:Feature-D-PS â”‚ 3:Feature-E-NonFunc â”‚"
echo "  â”‚ â”‚ PowerShell     â”‚ éæ©Ÿèƒ½è¦ä»¶           â”‚"
echo "  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo "  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
echo "  â”‚ 3æ®µç›®ï¼ˆä¸‹æ®µãƒ•ãƒ«å¹…ï¼‰                 â”‚"
echo "  â”‚ 4:Feature-A-Leader                  â”‚"
echo "  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "âŒ¨ï¸ tmuxãƒšã‚¤ãƒ³åˆ‡ã‚Šæ›¿ãˆ:"
echo "  Ctrl+b + 0: ğŸ¨ Feature-B-UI - 1æ®µç›®å·¦"
echo "  Ctrl+b + 1: ğŸ”§ Feature-C-API - 1æ®µç›®å³"
echo "  Ctrl+b + 2: ğŸ’» Feature-D-PowerShell - 2æ®µç›®å·¦"
echo "  Ctrl+b + 3: ğŸ”’ Feature-E-NonFunc - 2æ®µç›®å³"
echo "  Ctrl+b + 4: ğŸ¯ Feature-A-Leader - 3æ®µç›®ãƒ•ãƒ«å¹…"
echo ""

# ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¢ã‚¿ãƒƒãƒï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ã¿ï¼‰
if [ -t 0 ]; then
    tmux attach-session -t "$SESSION_NAME"
else
    echo "ğŸ‰ tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ '$SESSION_NAME' ãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸï¼"
    echo "æ¥ç¶šã™ã‚‹ã«ã¯: tmux attach-session -t $SESSION_NAME"
fi