#!/bin/bash

# ITSM сѓисѓ╣сЃєсЃатљїТЎѓУхитІЋсѓ╣сѓ»сЃфсЃЌсЃѕ
echo "­Ъџђ ITSM сѓисѓ╣сЃєсЃасѓњУхитІЋсЂЌсЂдсЂёсЂЙсЂЎ..."
echo "======================================="

# ТЌбтГўсЂ«сЃЌсЃГсѓ╗сѓ╣сѓњсѓ»сЃфсЃ╝сЃ│сѓбсЃЃсЃЌ
echo "­ЪД╣ ТЌбтГўсЂ«сЃЌсЃГсѓ╗сѓ╣сѓњсѓ»сЃфсЃ╝сЃ│сѓбсЃЃсЃЌСИГ..."
pkill -f "vite" 2>/dev/null || true
pkill -f "start-server.js" 2>/dev/null || true
pkill -f "secure-server.js" 2>/dev/null || true
sleep 2

# сЃљсЃЃсѓ»сѓесЃ│сЃЅсѓхсЃ╝сЃљсЃ╝УхитІЋ (сѓ╗сѓГсЃЦсѓбуЅѕ)
echo "­ЪЏА№ИЈ  сѓ╗сѓГсЃЦсѓбсЃљсЃЃсѓ»сѓесЃ│сЃЅсѓхсЃ╝сЃљсЃ╝сѓњУхитІЋСИГ..."
cd backend
PORT=8082 npm start &
BACKEND_PID=$!
cd ..

# сЃљсЃЃсѓ»сѓесЃ│сЃЅсЂ«УхитІЋсѓњтЙЁсЂц
sleep 3

# сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅсѓхсЃ╝сЃљсЃ╝УхитІЋ
echo "­Ъје сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅсѓхсЃ╝сЃљсЃ╝сѓњУхитІЋСИГ..."
npm run dev &
FRONTEND_PID=$!

# сЃЌсЃГсѓ╗сѓ╣IDсѓњУеўжї▓
echo $BACKEND_PID > .backend.pid
echo $FRONTEND_PID > .frontend.pid

echo "======================================="
echo "РюЁ сѓисѓ╣сЃєсЃаУхитІЋт«їС║є№╝Ђ"
echo ""
echo "­Ъїљ сѓбсѓ»сѓ╗сѓ╣URL:"
echo "   сЃЋсЃГсЃ│сЃѕсѓесЃ│сЃЅ: http://localhost:3001"
echo "   сЃљсЃЃсѓ»сѓесЃ│сЃЅ:   http://localhost:8082"
echo ""
echo "­ЪћЉ сЃєсѓ╣сЃѕсЃГсѓ░сѓцсЃ│:"
echo "   сЃдсЃ╝сѓХсЃ╝тљЇ: admin"
echo "   сЃЉсѓ╣сЃ»сЃ╝сЃЅ: admin123"
echo ""
echo "РЈ╣№ИЈ  тЂюТГбТќ╣Т│Ћ:"
echo "   ./stop-all.sh сѓњт«ЪУАї"
echo "   сЂЙсЂЪсЂ» Ctrl+C сѓњ2тЏъТі╝сЂЎ"
echo "======================================="

# тЂюТГбсѓисѓ░сЃісЃФсѓњтЙЁсЂц
trap 'kill $BACKEND_PID $FRONTEND_PID 2>/dev/null; exit' INT TERM

# сЃЋсѓЕсѓбсѓ░сЃЕсѓдсЃ│сЃЅсЂДт«ЪУАїуХЎуХџ
wait