<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ITSM運用システム - 修正版</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/react-router-dom@6.26.2/dist/umd/react-router-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { 
      font-family: system-ui, -apple-system, sans-serif; 
      margin: 0; 
      background: #f8fafc;
    }
    .loading { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      height: 100vh; 
      flex-direction: column;
    }
  </style>
</head>
<body>
  <div id="root">
    <div class="loading">
      <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mb-4"></div>
      <p class="text-xl text-slate-700">ITSM運用システム読み込み中...</p>
    </div>
  </div>

  <script>
    // Wait for all libraries to load
    window.addEventListener('load', function() {
      setTimeout(function() {
        initializeApp();
      }, 500); // Give libraries time to initialize
    });

    function initializeApp() {
      // Verify libraries are loaded
      if (typeof React === 'undefined') {
        console.error('React not loaded');
        return;
      }
      if (typeof ReactDOM === 'undefined') {
        console.error('ReactDOM not loaded');
        return;
      }
      if (typeof ReactRouterDOM === 'undefined') {
        console.error('ReactRouterDOM not loaded');
        return;
      }

      const { useState, useEffect, createContext, useContext } = React;
      
      // Check if ReactRouterDOM has the required components
      if (!ReactRouterDOM.HashRouter || !ReactRouterDOM.Routes || !ReactRouterDOM.Route) {
        console.error('ReactRouterDOM components not available:', Object.keys(ReactRouterDOM));
        return;
      }

      const { HashRouter, Routes, Route, Navigate, useNavigate } = ReactRouterDOM;

      // Auth Context
      const AuthContext = createContext();

      const AuthProvider = ({ children }) => {
        const [user, setUser] = useState(null);
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState(null);

        // Check for existing session
        useEffect(() => {
          const savedUser = sessionStorage.getItem('itsm_user');
          if (savedUser) {
            try {
              setUser(JSON.parse(savedUser));
            } catch (e) {
              sessionStorage.removeItem('itsm_user');
            }
          }
        }, []);

        const login = async (username, password) => {
          setError(null);
          setIsLoading(true);
          
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          if ((username === 'admin' && password === 'admin123') || 
              (username === 'operator' && password === 'operator123')) {
            const userData = { 
              username, 
              role: username === 'admin' ? 'ADMIN' : 'USER',
              id: username === 'admin' ? '1' : '2',
              email: username === 'admin' ? 'admin@company.com' : 'operator@company.com'
            };
            setUser(userData);
            sessionStorage.setItem('itsm_user', JSON.stringify(userData));
            setIsLoading(false);
            return true;
          } else {
            setError('ユーザー名またはパスワードが正しくありません');
            setIsLoading(false);
            return false;
          }
        };

        const logout = () => {
          setUser(null);
          setError(null);
          sessionStorage.removeItem('itsm_user');
        };

        return React.createElement(AuthContext.Provider, {
          value: { user, login, logout, isLoading, error }
        }, children);
      };

      const useAuth = () => useContext(AuthContext);

      // Login Page
      const LoginPage = () => {
        const [username, setUsername] = useState('');
        const [password, setPassword] = useState('');
        const { login, error, isLoading } = useAuth();
        const navigate = useNavigate();

        const handleSubmit = async (e) => {
          e.preventDefault();
          const success = await login(username, password);
          if (success) {
            navigate('/dashboard');
          }
        };

        return React.createElement('div', {
          className: 'min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-700 p-4'
        }, 
          React.createElement('div', {
            className: 'w-full max-w-md bg-white rounded-lg shadow-2xl p-8'
          }, [
            React.createElement('div', { key: 'header', className: 'text-center mb-8' }, [
              React.createElement('div', { 
                key: 'icon',
                className: 'w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl'
              }, '🔒'),
              React.createElement('h1', { 
                key: 'title',
                className: 'text-2xl font-bold text-slate-800 mb-1' 
              }, 'ITSM運用システム'),
              React.createElement('p', { 
                key: 'subtitle',
                className: 'text-sm text-slate-600' 
              }, 'プラットフォーム')
            ]),
            React.createElement('form', {
              key: 'form',
              onSubmit: handleSubmit,
              className: 'space-y-5'
            }, [
              React.createElement('div', { key: 'username-field' }, [
                React.createElement('label', {
                  key: 'username-label',
                  className: 'block text-sm font-medium text-slate-700 mb-2'
                }, 'ユーザー名'),
                React.createElement('input', {
                  key: 'username-input',
                  type: 'text',
                  value: username,
                  onChange: (e) => setUsername(e.target.value),
                  className: 'w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500',
                  placeholder: 'ユーザー名を入力',
                  required: true,
                  disabled: isLoading
                })
              ]),
              React.createElement('div', { key: 'password-field' }, [
                React.createElement('label', {
                  key: 'password-label',
                  className: 'block text-sm font-medium text-slate-700 mb-2'
                }, 'パスワード'),
                React.createElement('input', {
                  key: 'password-input',
                  type: 'password',
                  value: password,
                  onChange: (e) => setPassword(e.target.value),
                  className: 'w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500',
                  placeholder: 'パスワードを入力',
                  required: true,
                  disabled: isLoading
                })
              ]),
              React.createElement('div', {
                key: 'test-accounts',
                className: 'bg-blue-50 border border-blue-200 rounded-lg p-4'
              }, [
                React.createElement('p', { key: 'test-title', className: 'font-medium text-blue-800 text-sm mb-2' }, 'テストアカウント:'),
                React.createElement('p', { key: 'admin', className: 'text-xs text-blue-700' }, '管理者: admin / admin123'),
                React.createElement('p', { key: 'operator', className: 'text-xs text-blue-700' }, 'オペレータ: operator / operator123')
              ]),
              error && React.createElement('div', {
                key: 'error',
                className: 'bg-red-50 border border-red-200 rounded-lg p-4 text-sm text-red-800'
              }, error),
              React.createElement('button', {
                key: 'submit',
                type: 'submit',
                disabled: !username || !password || isLoading,
                className: 'w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-4 rounded-lg hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50'
              }, isLoading ? 'ログイン中...' : 'ログイン')
            ])
          ])
        );
      };

      // Dashboard Page
      const DashboardPage = () => {
        const { user, logout } = useAuth();
        
        return React.createElement('div', {
          className: 'min-h-screen bg-slate-50'
        }, [
          React.createElement('div', {
            key: 'header',
            className: 'bg-white shadow border-b border-slate-200'
          }, 
            React.createElement('div', {
              className: 'max-w-7xl mx-auto px-6 py-4 flex justify-between items-center'
            }, [
              React.createElement('h1', {
                key: 'title',
                className: 'text-2xl font-bold text-slate-800'
              }, 'ITSM運用システム'),
              React.createElement('div', {
                key: 'user-info',
                className: 'flex items-center space-x-4'
              }, [
                React.createElement('span', {
                  key: 'welcome',
                  className: 'text-slate-600'
                }, `ようこそ、${user?.username}さん`),
                React.createElement('button', {
                  key: 'logout',
                  onClick: logout,
                  className: 'bg-slate-600 text-white px-4 py-2 rounded-md hover:bg-slate-700'
                }, 'ログアウト')
              ])
            ])
          ),
          React.createElement('div', {
            key: 'content',
            className: 'max-w-7xl mx-auto px-6 py-8'
          }, [
            React.createElement('div', {
              key: 'welcome-card',
              className: 'bg-white rounded-lg shadow p-6 mb-6'
            }, [
              React.createElement('h2', {
                key: 'welcome-title',
                className: 'text-xl font-semibold text-slate-800 mb-2'
              }, 'ダッシュボード'),
              React.createElement('p', {
                key: 'welcome-text',
                className: 'text-slate-600'
              }, 'ITSM運用システムへようこそ。システムが正常に動作しています。')
            ]),
            React.createElement('div', {
              key: 'success-message',
              className: 'bg-green-50 border border-green-200 rounded-lg p-6'
            }, [
              React.createElement('div', {
                key: 'success-header',
                className: 'flex items-center mb-2'
              }, [
                React.createElement('span', { key: 'icon', className: 'text-green-600 mr-2 text-xl' }, '✅'),
                React.createElement('h3', { key: 'title', className: 'font-medium text-green-800' }, '修正完了')
              ]),
              React.createElement('p', {
                key: 'success-text',
                className: 'text-green-700'
              }, 'React Router DOM のエラーが修正されました。全ての機能が正常に動作しています。')
            ])
          ])
        ]);
      };

      // Protected Route
      const ProtectedRoute = ({ children }) => {
        const { user } = useAuth();
        return user ? children : React.createElement(Navigate, { to: '/login', replace: true });
      };

      // Main App
      const App = () => {
        return React.createElement(AuthProvider, {},
          React.createElement(HashRouter, {},
            React.createElement(Routes, {}, [
              React.createElement(Route, {
                key: 'login',
                path: '/login',
                element: React.createElement(LoginPage)
              }),
              React.createElement(Route, {
                key: 'dashboard',
                path: '/dashboard',
                element: React.createElement(ProtectedRoute, {},
                  React.createElement(DashboardPage)
                )
              }),
              React.createElement(Route, {
                key: 'root',
                path: '/',
                element: React.createElement(Navigate, { to: '/dashboard', replace: true })
              })
            ])
          )
        );
      };

      // Render the app
      ReactDOM.render(React.createElement(App), document.getElementById('root'));
    }
  </script>
</body>
</html>